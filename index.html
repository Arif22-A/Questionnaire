<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OCEAN BAR & KITCHEN</title>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #000;
      color: #FFD700;
      margin: 0;
      padding: 0;
    }
    header {
      text-align: center;
      padding: 20px;
      border-bottom: 2px solid gold;
    }
    header img {
      max-width: 200px;
      display: block;
      margin: 0 auto 10px auto;
      padding-top: 16px;
    }
    h1 {
      font-size: 24px;
      color: #F0F8FF; /* AliceBlue, mirip iceblue */
      
    }
    .container {
  width: 90%;              /* biar ada napas kanan-kiri */
  max-width: 1000px;        /* maksimal di layar besar */
  margin: 20px auto;
  padding: 20px;
  background: rgba(20, 20, 20, 0.95);
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(255, 217, 0, 0.425);
  border: 2px solid #FFD700;
  box-sizing: border-box;  /* hitung padding biar gak nambahin lebar */
}

    fieldset {
  border: 2px solid #FFD700;   /* garis tepi penuh emas */
  margin-bottom: 20px;
  padding: 15px;
  border-radius: 10px;
  background: rgba(10,10,10,0.7); /* biar ada efek kotak */
  box-shadow: 0 0 12px rgba(255,215,0,0.3); /* glow tipis emas */
}

    legend {
      font-weight: bold;
      color: #FFD700;
      text-shadow: 0 0 5px rgba(255,215,0,0.5);
    }
    label {
      display: block;
      margin: 8px 0;
    }
    input[type="radio"], input[type="checkbox"] {
      accent-color: gold;
      transform: scale(1.2);
      margin-right: 8px;
    }
    input[type="radio"]:checked, input[type="checkbox"]:checked {
      filter: drop-shadow(0 0 4px gold);
    }
    select, textarea, input[type="text"] {
      width: 98%;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #FFD700;
      background: #111;
      color: #FFD700;
    }
    button {
      background: linear-gradient(45deg, #FFD700, #FFA500);
      border: none;
      color: #000;
      padding: 12px 20px;
      margin: 10px 5px;
      border-radius: 30px;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      text-align: center;
    }
    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(255,215,0,0.8);
    }
    footer {
      text-align: center;
      padding: 15px;
      border-top: 2px solid gold;
      margin-top: 30px;
    }
    .rating label {
      display: inline-block;
      margin: 0 8px;
      cursor: pointer;
    }
    .rating input[type="radio"] {
      display: none;
    }
    .rating span {
      display: inline-block;
      width: 28px;
      height: 28px;
      line-height: 28px;
      text-align: center;
      border: 1px solid #FFD700;
      border-radius: 50%;
      transition: all 0.3s ease;
    }
    .rating input[type="radio"]:checked + span {
      background: gold;
      color: #000;
      box-shadow: 0 0 10px gold;
    }
    .voucher-card{
  background: rgba(20, 20, 20, 0.9);
  border: 2px solid #FFD700;          /* garis tepi emas */
  border-radius: 12px;                /* sudut melengkung */
  padding: 20px;
  margin: 15px 0;
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.3); /* glow emas */
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  text-align: center;
}

.voucher-card:hover {
  transform: scale(1.03);
  box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); /* glow lebih terang saat hover */
}
.voucher-img {width: 90%
}

.btn-row {
  display: flex;
  justify-content: center;   /* bikin tombol rata tengah */
  gap: 12px;                 /* jarak antar tombol */
  flex-wrap: wrap;           /* kalau layar kecil tombol pindah ke bawah */
}

.btn-row button {
  min-width: 180px;          /* semua tombol punya lebar sama */
  text-align: center;
  padding: 12px 20px;
  border-radius: 30px;
  font-weight: bold;
}

.lead {
  color: #F0F8FF; /* AliceBlue, mirip iceblue */
  }
  .lead-highlight {
    text-shadow: 0 0 10px rgba(255,215,0,0.7);
  }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="container" role="region" aria-label="Kuisioner Kepuasan Pelanggan Restoran">
      <header>
        <div class="logo"><img src="logo.png" alt="Logo Restoran" id="logoVisible"></div>
        <div>
          <h1>OCEAN BAR &amp; KITCHEN</h1>
           <p class="lead">üìç Jl.Ahmad Yani 34, Kutorejo, Sragen Tengah, 
           <p class="lead">Kec Sragen, Kab Sragen, Jawa Tengah 57212</p>
          <p class="lead">‚òéÔ∏è +62 857-1246-9835</p>
          <br>
          <p class="lead">Hallo Oceaner's..</p>
          <p class="lead-highlight">Bantu kami berkembang ‚Äî isi kuisioner singkat ini.
            <div>Semua jawaban bersifat anonim.</p></div>
        </div>
      </header>

      <form id="survey" autocomplete="off">
        <div class="section grid">
          <div>
            <label class="field">Nomor Meja</label>
            <input type="text" id="meja" placeholder="Contoh: 12" />
          </div>

          <div>
            <label class="field">Tanggal & Jam</label>
            <input type="text" id="waktu" readonly />
          </div>

          <div>
            <label class="field">Nama (opsional)</label>
            <input type="text" id="nama" placeholder="Contoh: Budi" />
          </div>

          <div>
            <label class="field">Usia</label>
            <select id="usia">
              <option value="">Pilih rentang usia</option>
              <option>&lt; 18</option>
              <option>18‚Äì25</option>
              <option>26‚Äì35</option>
              <option>36‚Äì45</option>
              <option>&gt; 45</option>
            </select>
          </div>

          <div>
            <label class="field">Jenis Kelamin</label>
            <select id="gender">
              <option value="">Pilih</option>
              <option>Laki-laki</option>
              <option>Perempuan</option>
              <option>Prefer not to say</option>
            </select>
          </div>

          <div>
            <label class="field">Frekuensi kunjungan</label>
            <select id="freq">
              <option value="">Pilih</option>
              <option>Pertama kali</option>
              <option>1‚Äì2 kali/bulan</option>
              <option>3‚Äì5 kali/bulan</option>
              <option>> 5 kali/bulan</option>
            </select>
          </div>
        </div>

        <div class="section full">
          <label class="field">Penilaian (1 = Sangat Tidak Puas, 5 = Sangat Puas)</label>
          <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px">
            <div>
              <label class="field">Kualitas rasa makanan</label>
              <div class="radio-row" data-name="rasa"></div>
            </div>
            <div>
              <label class="field">Variasi menu</label>
              <div class="radio-row" data-name="variasi"></div>
            </div>
            <div>
              <label class="field">Kebersihan</label>
              <div class="radio-row" data-name="kebersihan"></div>
            </div>
            <div>
              <label class="field">Keramahan staff</label>
              <div class="radio-row" data-name="pelayanan"></div>
            </div>
            <div>
              <label class="field">Kecepatan penyajian</label>
              <div class="radio-row" data-name="kecepatan"></div>
            </div>
            <div>
              <label class="field">Kenyamanan & suasana</label>
              <div class="radio-row" data-name="suasana"></div>
            </div>
            <div style="grid-column:1/-1">
              <label class="field">Harga sesuai kualitas</label>
              <div class="radio-row" data-name="harga"></div>
            </div>
          </div>
        </div>

        <div class="section full">
          <label class="field">Apa yang paling Anda sukai dari restoran kami?</label>
          <textarea id="suka" placeholder="Tulis komentar singkat..."></textarea>
        </div>

        <div class="section full">
          <label class="field">Apa yang perlu diperbaiki?</label>
          <textarea id="perbaikan" placeholder="Masukkan saran..."></textarea>
        </div>

        <div class="section full">
          <label class="field">Apakah Anda akan merekomendasikan restoran kami?</label>
          <div style="display:flex;gap:12px">
            <label style="display:flex;gap:8px;align-items:center"><input type="radio" name="rekomend" value="Ya"> Ya</label>
            <label style="display:flex;gap:8px;align-items:center"><input type="radio" name="rekomend" value="Tidak"> Tidak</label>
          </div>
        </div>

        <!-- Simpan (simpan ke localStorage saja) -->
        <div style="margin-top:12px;text-align:center">
          <button id="saveBtn" type="button" class="btn-simpan">Simpan</button>
        </div>

        <!-- Voucher card (appear after save) -->
        <div id="voucherCard" class="voucher-card" style="display:none;">
          <h3>üéâ Selamat! Anda mendapatkan Voucher Diskon üéâ</h3>
          <!-- visible voucher image in card -->
          <img src="voucher.png" id="voucherVisible" class="voucher-img" alt="Voucher" />
          <div>
            <button id="claimVoucher" class="btn">Klaim Voucher</button>
          </div>
        </div>

        <!-- Final buttons (appear after claim) -->
        <div class="btn-row full" id="finalButtons" style="display:none;margin-top:14px;">
          <button type="button" class="btn btn-ghost" id="resetBtn">Reset</button>
          <button type="button" class="btn btn-gold" id="downloadSendBtn">Download &amp; Kirim ke WA</button>
        </div>
      </form>

      <footer style="margin-top:14px;">
        <small>@2025 OCEAN BAR &amp; KITCHEN ‚Äî Terima kasih</small>
      </footer>
    </div>
  </div>

  <!-- Hidden images for PDF (use same sources, can be remote or local) -->
  <img id="logoResto" src="logo.png" style="display:none" alt="logo">
  <img id="voucherImg" src="voucher.png" style="display:none" alt="voucher">

  <script>
    /**************************************************************************
     * Full final script
     * - rating builder
     * - save to localStorage (Simpan)
     * - voucher card show
     * - claim -> show Reset + Download&Send
     * - reset clears localStorage & form
     * - download&send creates PDF (logo + resto info + semua data + voucher image)
     *   and then opens WhatsApp chat to admin
     **************************************************************************/

    (function(){
      const ratingFields = ['rasa','variasi','kebersihan','pelayanan','kecepatan','suasana','harga'];
      const storeKey = 'kuisioner_restoran_v1';
      const adminWA = '6285712469835'; // ganti nomor admin sesuai keperluan (format internasional tanpa +)

      // build rating controls
      function createRating(el, name){
        for(let i=1;i<=5;i++){
          const btn = document.createElement('label');
          btn.className = 'radio-dot';
          btn.title = i+' dari 5';
          btn.innerHTML = `<input type="radio" name="${name}" value="${i}"><span>${i}</span>`;
          btn.addEventListener('click',(e)=>{
            const parent = e.currentTarget.parentElement;
            parent.querySelectorAll('.radio-dot').forEach(nd=>nd.classList.remove('selected'));
            e.currentTarget.classList.add('selected');
          });
          el.appendChild(btn);
        }
      }
      document.querySelectorAll('.radio-row').forEach(r=>createRating(r, r.dataset.name));

      // form elements
      const form = document.getElementById('survey');
      const saveBtn = document.getElementById('saveBtn');
      const claimBtn = document.getElementById('claimVoucher');
      const voucherCard = document.getElementById('voucherCard');
      const finalButtons = document.getElementById('finalButtons');
      const resetBtn = document.getElementById('resetBtn');
      const downloadSendBtn = document.getElementById('downloadSendBtn');

      // helper: get current form data (including rating values)
      function getFormData(){
        const data = {};
        data.meja = (document.getElementById('meja')?.value || '').trim();
        data.waktu = (document.getElementById('waktu')?.value || '').trim();
        data.nama = (document.getElementById('nama')?.value || '').trim();
        data.usia = (document.getElementById('usia')?.value || '').trim();
        data.gender = (document.getElementById('gender')?.value || '').trim();
        data.freq = (document.getElementById('freq')?.value || '').trim();
        ratingFields.forEach(f=>{
          const val = document.querySelector(`input[name="${f}"]:checked`);
          data[f] = val ? val.value : '';
        });
        data.suka = (document.getElementById('suka')?.value || '').trim();
        data.perbaikan = (document.getElementById('perbaikan')?.value || '').trim();
        const rekom = document.querySelector('input[name="rekomend"]:checked');
        data.rekomend = rekom ? rekom.value : '';
        data.timestamp = new Date().toLocaleString('id-ID');
        return data;
      }

      // populate form from saved object (including rating UI)
      function populateForm(data){
        if(!data) return;
        if(data.meja) document.getElementById('meja').value = data.meja;
        if(data.waktu) document.getElementById('waktu').value = data.waktu;
        if(data.nama) document.getElementById('nama').value = data.nama;
        if(data.usia) document.getElementById('usia').value = data.usia;
        if(data.gender) document.getElementById('gender').value = data.gender;
        if(data.freq) document.getElementById('freq').value = data.freq;
        if(data.suka) document.getElementById('suka').value = data.suka;
        if(data.perbaikan) document.getElementById('perbaikan').value = data.perbaikan;
        if(data.rekomend){
          const node = document.querySelector(`input[name="rekomend"][value="${data.rekomend}"]`);
          if(node) node.checked = true;
        }
        // restore ratings
        ratingFields.forEach(f=>{
          if(data[f]){
            const input = document.querySelector(`input[name="${f}"][value="${data[f]}"]`);
            if(input){
              input.checked = true;
              // add selected class to label parent
              const lbl = input.closest('label.radio-dot') || input.parentElement;
              // clear others then add
              const parent = input.closest('.radio-row');
              if(parent){
                parent.querySelectorAll('.radio-dot').forEach(nd=>nd.classList.remove('selected'));
                if(lbl) lbl.classList.add('selected');
              }
            }
          }
        });
      }

      // save current form to localStorage (Simpan button)
      function saveToLocal(){
        const data = getFormData();
        localStorage.setItem(storeKey, JSON.stringify(data));
        return data;
      }

      // load saved from localStorage (on load)
      function loadFromLocal(){
        try{
          const raw = localStorage.getItem(storeKey);
          if(!raw) return null;
          const obj = JSON.parse(raw);
          populateForm(obj);
          return obj;
        }catch(e){
          console.error('Gagal parse localStorage', e);
          return null;
        }
      }

      // clear storage and UI
      function clearAll(){
        localStorage.removeItem(storeKey);
        form.reset();
        // clear selected classes
        document.querySelectorAll('.radio-dot.selected').forEach(el=>el.classList.remove('selected'));
        // reset waktu to now
        setWaktuNow();
      }

      // set waktu input to now (formatted)
      function setWaktuNow(){
        const waktuInput = document.getElementById('waktu');
        if(!waktuInput) return;
        const now = new Date();
        const options = { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' };
        waktuInput.value = now.toLocaleString('id-ID', options);
      }

      // convert image url -> base64 data URL (used for embedding images into PDF)
      async function getBase64ImageFromUrl(url){
        if(!url) return null;
        try{
          const res = await fetch(url);
          const blob = await res.blob();
          return await new Promise((resolve,reject)=>{
            const reader = new FileReader();
            reader.onloadend = ()=>resolve(reader.result);
            reader.onerror = reject;
            reader.readAsDataURL(blob);
          });
        }catch(err){
          console.warn('Gagal fetch image (CORS?)', url, err);
          return null;
        }
      }

      // create PDF with full layout: header (logo/info), responden, ratings, comments, voucher (if claimed)
      async function createPdfAndDownload(data, includeVoucher){
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({unit:'pt', format:'a4'}); // use pt for finer control
        const marginLeft = 40;
        let y = 40;

        // header: logo + restaurant info
        const logoEl = document.getElementById('logoResto');
        if(logoEl && logoEl.src){
          const logoData = await getBase64ImageFromUrl(logoEl.src);
          if(logoData) {
            // width 60 pt (~ 20mm)
            doc.addImage(logoData, 'PNG', marginLeft, y, 60, 60);
          }
        }

        doc.setFont('helvetica','bold');
        doc.setFontSize(18);
        doc.text('OCEAN BAR & KITCHEN', marginLeft + 80, y + 18);

        doc.setFont('helvetica','normal');
        doc.setFontSize(10);
        const infoLines = [
          'Jl.Ahmad Yani 34, Kutorejo, Sragen Tengah,Sragen, 57212',
          '+62 857-1246-9835'
        ];
        let infoY = y + 36;
        infoLines.forEach(ln=>{
          doc.text(ln, marginLeft + 80, infoY);
          infoY += 14;
        });

        // horizontal line
        doc.setLineWidth(0.5);
        doc.line(marginLeft, infoY + 6, 555, infoY + 6);
        y = infoY + 24;

        // Title Data Responden
        doc.setFont('helvetica','bold');
        doc.setFontSize(14);
        doc.text('Data Responden', marginLeft, y);
        y += 18;

        // left column with respondent data
        doc.setFont('helvetica','normal');
        doc.setFontSize(11);
        const rows = [
          ['Nomor Meja', data.meja || '-'],
          ['Tanggal & Jam', data.waktu || '-'],
          ['Nama', data.nama || '-'],
          ['Usia', data.usia || '-'],
          ['Jenis Kelamin', data.gender || '-'],
          ['Frekuensi Kunjungan', data.freq || '-'],
        ];
        rows.forEach(([k,v])=>{
          doc.text(`${k}:`, marginLeft, y);
          doc.text(String(v), marginLeft + 130, y);
          y += 14;
        });

        y += 8;
        // Ratings section
        doc.setFont('helvetica','bold');
        doc.text('Penilaian (1-5)', marginLeft, y);
        y += 16;
        doc.setFont('helvetica','normal');
        ratingFields.forEach(f=>{
          const label = f[0].toUpperCase() + f.slice(1); // simple label
          const val = data[f] || '-';
          doc.text(`${label}: ${val}`, marginLeft, y);
          y += 12;
        });

        y += 8;
        // Comments
        doc.setFont('helvetica','bold');
        doc.text('Komentar', marginLeft, y);
        y += 14;
        doc.setFont('helvetica','normal');
        doc.text('Apa yang paling disukai:', marginLeft, y);
        doc.text(data.suka || '-', marginLeft + 16, y + 12);
        y += 30;
        doc.text('Saran / Perbaikan:', marginLeft, y);
        // wrap long text for perbaikan
        const perbaikanText = data.perbaikan || '-';
        const splitPerbaikan = doc.splitTextToSize(perbaikanText, 480);
        doc.text(splitPerbaikan, marginLeft + 16, y + 12);
        y += (splitPerbaikan.length * 12) + 10;

        // Voucher
        if(includeVoucher){
          // add voucher title then image (if available)
          doc.setFont('helvetica','bold');
          doc.setFontSize(13);
          doc.text('Voucher Diskon', marginLeft, y);
          y += 10;
          const voucherEl = document.getElementById('voucherImg');
          if(voucherEl && voucherEl.src){
            const vData = await getBase64ImageFromUrl(voucherEl.src);
            if(vData){
              // fit voucher image, width 180pt
              const imgW = 180;
              const imgH = 100;
              // if not enough space, add new page
              if(y + imgH > 760){ doc.addPage(); y = 40; }
              doc.addImage(vData, 'PNG', marginLeft, y, imgW, imgH);
              y += imgH + 10;
            }
          } else {
            doc.setFontSize(11);
            doc.setFont('helvetica','normal');
            doc.text('Voucher: Diskon tersedia', marginLeft, y);
            y += 16;
          }
        }

        // Footer thank you
        doc.setFont('helvetica','italic');
        doc.setFontSize(10);
        if(y + 40 > 780) { doc.addPage(); y = 40; }
        doc.text('Terima kasih sudah membantu kami berkembang dengan mengisi kuisioner ini.', marginLeft, y + 20);

        // auto-download
        const filename = 'kuisioner_' + (new Date()).toISOString().slice(0,19).replace(/[:T]/g,'-') + '.pdf';
        doc.save(filename);
        return filename;
      }

      // Download & Send to WA (download PDF then open wa.me)
      async function handleDownloadAndSend(){
        const data = getFormData();
        // include voucher only if voucherCard was claimed (finalButtons visible)
        const includeVoucher = (finalButtons.style.display !== 'none');
        await createPdfAndDownload(data, includeVoucher);
        // open WhatsApp chat (cannot auto attach file via wa.me)
        const pesan = encodeURIComponent('Halo admin, saya sudah mengisi kuisioner dan mengklaim voucher. File PDF sudah saya simpan, mohon cek.');
        window.open(`https://wa.me/${adminWA}?text=${pesan}`, '_blank');
      }

      // initialize
      function init(){
        // set waktu now
        setWaktuNow();
        // load local if exists (and show voucher if previously saved)
        const saved = loadFromLocal();
        if(saved){
          // if data exists in storage, show voucher card (so user can claim)
          voucherCard.style.display = 'block';
        }
        // wire up events
        saveBtn.addEventListener('click', (e)=>{
          e.preventDefault();
          const saved = saveToLocal();
          voucherCard.style.display = 'block';
          alert('Data tersimpan sementara.');
        });

        claimBtn.addEventListener('click', (e)=>{
          e.preventDefault();
          // mark in localStorage that voucher is claimed
          const objRaw = localStorage.getItem(storeKey);
          let obj = objRaw ? JSON.parse(objRaw) : getFormData();
          obj.voucherClaimed = true;
          localStorage.setItem(storeKey, JSON.stringify(obj));
          finalButtons.style.display = 'flex';
          alert('Selamat Anda mendapatkan voucher potongan harga.');
        });

        resetBtn.addEventListener('click', (e)=>{
          e.preventDefault();
          if(confirm('Reset semua isian dan hapus data tersimpan?')){
            clearAll();
            voucherCard.style.display = 'none';
            finalButtons.style.display = 'none';
          }
        });

        // form submit should be same as download&send (user may press Enter)
        form.addEventListener('submit', async (e)=>{
          e.preventDefault();
          // require that user has claimed voucher before sending (per flow)
          const raw = localStorage.getItem(storeKey);
          const savedObj = raw ? JSON.parse(raw) : null;
          if(!(savedObj && savedObj.voucherClaimed)){
            // If not claimed yet, show message and do not send
            alert('Silakan klik tombol "Simpan" lalu "Klaim Voucher" sebelum mengirim.');
            return;
          }
          // ensure at least one rating selected
          const data = getFormData();
          const anyRating = ratingFields.some(f=>data[f]);
          if(!anyRating){
            alert('Mohon beri penilaian minimal pada salah satu kategori.');
            return;
          }
          await handleDownloadAndSend();
          // after sending we can clear if desired:
          // clearAll(); voucherCard.style.display='none'; finalButtons.style.display='none';
        });

        // download/send button
        document.getElementById('downloadSendBtn').addEventListener('click', async (e)=>{
          e.preventDefault();
          // check claimed
          const raw = localStorage.getItem(storeKey);
          const savedObj = raw ? JSON.parse(raw) : null;
          if(!(savedObj && savedObj.voucherClaimed)){
            alert('Silakan klaim voucher terlebih dahulu.');
            return;
          }
          // validate ratings
          const data = getFormData();
          const anyRating = ratingFields.some(f=>data[f]);
          if(!anyRating){
            alert('Mohon beri penilaian minimal pada salah satu kategori.');
            return;
          }
          // save current form to local (update)
          localStorage.setItem(storeKey, JSON.stringify(Object.assign({}, savedObj, data, {voucherClaimed: true})));
          await handleDownloadAndSend();
        });
      } // init end

      // run init on DOM ready
      document.addEventListener('DOMContentLoaded', init);
    })();
  </script>
</body>
</html>








